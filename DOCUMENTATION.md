# Документация проекта КиберБлог

## Обзор проекта

КиберБлог - персональная блог-платформа с киберпанк-дизайном, разработанная на основе веб-фреймворка Flask с использованием MongoDB в качестве базы данных. 

## Архитектура проекта

Проект построен с использованием паттерна "Фабрика приложений" (Application Factory Pattern) во Flask, что обеспечивает гибкость конфигурации и масштабируемость.

### Основные компоненты:

1. **app.py** - основной файл приложения, содержащий фабрику приложения `create_app()`
2. **config.py** - настройки приложения для разных окружений (разработка, тестирование, продакшн)
3. **models/** - модели данных для работы с MongoDB
4. **routes/** - маршруты и контроллеры приложения
5. **templates/** - HTML-шаблоны (Jinja2)
6. **static/** - статические файлы (CSS, JavaScript, изображения)
7. **forms/** - формы для валидации данных
8. **utils/** - вспомогательные функции

## Модели данных

Проект использует MongoDB в качестве NoSQL базы данных. Основные модели:

1. **User** - модель пользователя системы
2. **Post** - модель статьи/поста блога
3. **Comment** - модель комментария к статье
4. **Category** - модель категории статей
5. **Reaction** - модель реакций пользователей на статьи
6. **Thesaurus** - модель для хранения терминов тезауруса

## Маршруты (Routes)

Приложение использует Blueprint-паттерн Flask для организации маршрутов:

1. **main_bp** - основные страницы сайта
2. **auth_bp** - аутентификация и управление пользователями
3. **blog_bp** - функционал блога (статьи, комментарии, категории)
4. **thesaurus_bp** - функционал тезауруса терминов
5. **admin_bp** - административная панель

## Конфигурация

Конфигурация разделена на три окружения:
- **DevelopmentConfig** - настройки для разработки
- **TestingConfig** - настройки для тестирования
- **ProductionConfig** - настройки для промышленной эксплуатации

Основные параметры конфигурации:
- Настройки подключения к MongoDB
- Настройки безопасности (SECRET_KEY)
- Настройки для загрузки файлов и ограничения размеров
- Настройки для отправки email
- Настройки пагинации и кэширования

## Функциональные возможности

### Система пользователей
- Регистрация и аутентификация пользователей
- Профили пользователей с аватарами
- Уровни доступа (обычный пользователь, администратор)

### Блог
- Создание, редактирование и удаление статей
- Поддержка Markdown с подсветкой синтаксиса
- Категории и теги для статей
- Система комментариев
- Реакции на статьи (лайки и другие эмоции)

### Тезаурус
- База терминов с определениями
- Категоризация терминов
- Возможность добавления и редактирования терминов

### Административная панель
- Управление пользователями
- Модерация контента
- Управление категориями
- Статистика использования

## Технические детали

### Используемые расширения Flask:
- **Flask-Login** - для управления сессиями пользователей
- **Flask-WTF** - для работы с формами и защиты от CSRF
- **Flask-PyMongo** - для работы с MongoDB
- **Flask-Misaka** - для рендеринга Markdown
- **Flask-Mail** - для отправки email

### Безопасность:
- Хэширование паролей
- CSRF-защита для форм
- Проверка загружаемых файлов
- Защита от XSS через Markdown-парсер

## Установка и запуск

### Предварительные требования:
- Python 3.8+
- MongoDB
- Установленные пакеты:
  - Flask и его расширения (Flask-Login, Flask-WTF, Flask-PyMongo, Flask-Markdown, Flask-Mail, Flask-Caching, Flask-Bcrypt, Flask-Moment)
  - PyMongo
  - python-dotenv
  - beautifulsoup4
  - pygments
  - Pillow
  - python-slugify
  - email-validator
  - bleach
  - и другие зависимости из requirements.txt

### Установка:
1. Клонировать репозиторий
2. Создать виртуальное окружение Python
3. Установить зависимости из requirements.txt
4. Настроить переменные окружения в файле .env
5. Запустить приложение через Flask или WSGI-сервер

### Запуск приложения:
1. Активировать виртуальное окружение:
   ```
   .\.venv\Scripts\activate  # Для Windows
   source .venv/bin/activate  # Для Linux/Mac
   ```

2. Установить все зависимости:
   ```
   pip install -r requirements.txt
   
   # Если некоторые пакеты отсутствуют, установить их отдельно:
   pip install beautifulsoup4 pygments
   ```

3. Запустить приложение через скрипт:
   ```
   # Создать файл run_app.ps1 (для Windows):
   $env:MONGO_URI = "mongodb://localhost:27017/cyberblog"
   $env:FLASK_ENV = "development"
   $env:SECRET_KEY = "your_secret_key"
   $env:DEBUG = "True"
   $env:MONGO_CLIENT = "mongodb://localhost:27017/cyberblog"
   
   Write-Host "Запуск приложения КиберБлог..."
   .\.venv\Scripts\python app.py
   
   # Затем выполнить:
   .\run_app.ps1
   ```

4. Или запустить через командную строку:
   ```
   # Для Windows PowerShell:
   $env:MONGO_URI="mongodb://localhost:27017/cyberblog"; $env:FLASK_ENV="development"; $env:SECRET_KEY="your_secret_key"; $env:DEBUG="True"; $env:MONGO_CLIENT="mongodb://localhost:27017/cyberblog"; python app.py
   
   # Для Linux/Mac:
   export MONGO_URI="mongodb://localhost:27017/cyberblog" FLASK_ENV="development" SECRET_KEY="your_secret_key" DEBUG="True" MONGO_CLIENT="mongodb://localhost:27017/cyberblog" && python app.py
   ```

5. Приложение будет доступно по адресу http://127.0.0.1:5000/

### Переменные окружения:
- `SECRET_KEY` - секретный ключ для Flask
- `MONGO_URI` - URI подключения к MongoDB
- `MAIL_*` - настройки для отправки email
- `FLASK_ENV` - окружение (development, testing, production)

## Структура проекта

```
cyberblog/
├── app.py                  # Точка входа в приложение
├── config.py               # Конфигурация приложения
├── requirements.txt        # Зависимости проекта
├── models/                 # Модели данных
│   ├── user.py             # Модель пользователя
│   ├── post.py             # Модель статьи
│   ├── comment.py          # Модель комментария
│   ├── category.py         # Модель категории
│   ├── reaction.py         # Модель реакции
│   └── thesaurus.py        # Модель термина тезауруса
├── routes/                 # Маршруты и представления
│   ├── main.py             # Основные страницы
│   ├── auth.py             # Аутентификация
│   ├── blog.py             # Функционал блога
│   ├── thesaurus.py        # Функционал тезауруса
│   ├── admin.py            # Административная панель
│   ├── errors.py           # Обработчики ошибок
│   └── context_processors.py # Контекстные процессоры
├── forms/                  # Формы
├── utils/                  # Вспомогательные функции
├── static/                 # Статические файлы
│   ├── css/                # CSS-стили
│   ├── js/                 # JavaScript-файлы
│   ├── img/                # Изображения
│   └── uploads/            # Загруженные пользователями файлы
└── templates/              # HTML-шаблоны
    ├── base.html           # Базовый шаблон
    ├── index.html          # Главная страница
    ├── auth/               # Шаблоны авторизации
    ├── blog/               # Шаблоны блога
    ├── thesaurus/          # Шаблоны тезауруса
    ├── admin/              # Шаблоны админки
    └── errors/             # Шаблоны ошибок
```

## Устранение неполадок

### Проблема с MongoDB
Если при запуске приложения возникает ошибка `KeyError: 'MONGO_CLIENT'`, необходимо добавить MONGO_CLIENT в конфигурацию приложения:
1. В файле app.py добавить строку `app.config['MONGO_CLIENT'] = client` перед `return app`
2. При запуске через командную строку или скрипт указать переменную окружения MONGO_CLIENT

### Проблема с шаблонами
Если возникает ошибка `TemplateNotFound`, проверьте пути к шаблонам в маршрутах и структуру директории templates.

### Проблема с тегами Jinja
Если возникает ошибка `TemplateSyntaxError: Encountered unknown tag`, проверьте правильность использования тегов и фильтров в шаблонах.

### Проблема с аргументами методов моделей
Если возникает ошибка `TypeError: ... missing 1 required positional argument: 'db'`, убедитесь, что при вызове методов моделей передается объект базы данных.

### Проблема с импортом flaskext.markdown
В приложении используется импорт `from flaskext.markdown import Markdown`, но этот модуль является частью пакета Flask-Markdown. Если возникает ошибка импорта, убедитесь, что пакет Flask-Markdown установлен:
```
pip install Flask-Markdown
```

## Лицензия

MIT License 